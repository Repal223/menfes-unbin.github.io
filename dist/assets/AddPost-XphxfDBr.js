import{r as c,f as v,d as g,a as _,e as w,j as a,g as N,n as b,c as S,s as y}from"./index-DmEEzxp2.js";import{s as m,h as u}from"./clean-BY0QpW96.js";const C=[{key:"Positif",words:["senang","bahagia","semangat","keren","hebat","cinta","bangga","mantap","thanks","terima kasih","asik","asyik","ceria"]},{key:"Negatif",words:["sedih","kecewa","marah","kesal","kesel","kacau","capek","lelah","benci","down","bad"]},{key:"Lucu",words:["lucu","ketawa","wkwk","haha","ngakak"]},{key:"Penasaran",words:["kenapa","gimana","kok","siapa","kapan"]},{key:"Netral",words:[]}];function T(s){if(!s)return"Netral";const n=String(s).toLowerCase();let r="Netral",i=0;for(const t of C){let l=0;for(const e of t.words)n.includes(e)&&l++;l>i&&(i=l,r=t.key)}return r}function D(){const[s,n]=c.useState({status:"open",message:"Server aktif"});return c.useEffect(()=>{const r=v(g,"appConfig","status"),i=_(r,t=>{t.exists()&&n(t.data())});return()=>i()},[]),s}function P(){const[s,n]=c.useState({nama_anonim:"",mood:"",isi_pesan:"",to:""}),[r,i]=c.useState(!1),t=w(),l=D(),e={nama_anonim:50,mood:30,isi_pesan:500,to:50},x=async o=>{o.preventDefault(),i(!0);try{const h="last_post_ts",p=Date.now(),f=parseInt(localStorage.getItem(h)||"0",10);if(p-f<3e4){t.show("Terlalu cepat. Coba lagi sebentar.","error"),i(!1);return}const k=N();let d={nama_anonim:m(s.nama_anonim),mood:m(s.mood),isi_pesan:m(s.isi_pesan),to:m(s.to)};(!d.mood||!d.mood.trim())&&(d.mood=T(d.isi_pesan));const j=u(d.isi_pesan)||u(d.mood);await b(S(g,"posts"),{...d,uid:k,created_at:y(),love:0,likes:0,total_comments:0,flagged:j,deleted:!1}),t.show("Pesan terkirim!","ok"),localStorage.setItem(h,String(p)),n({nama_anonim:"",mood:"",isi_pesan:"",to:""})}catch{t.show("Gagal mengirim","error")}i(!1)};return a.jsxs("div",{style:{position:"relative"},children:[a.jsx("div",{className:"compose-bg"}),a.jsxs("div",{className:"compose-card",style:{maxWidth:780,margin:"20px auto"},children:[a.jsxs("div",{className:"compose-header",children:[a.jsx("h2",{children:"Kirim Pesan"}),a.jsx("p",{children:"Ekspresikan pikiranmu dengan santun. Tetap anonim."})]}),l.status!=="open"&&a.jsxs("div",{className:"compose-banner warning",children:["Server ",l.status,". ",l.message||""]}),a.jsxs("form",{onSubmit:x,className:"compose-form",children:[a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Nama Anonim"}),a.jsx("input",{placeholder:"Contoh: Bintang Timur",value:s.nama_anonim,maxLength:e.nama_anonim,onChange:o=>n({...s,nama_anonim:o.target.value})}),a.jsx("div",{className:"hint-row",children:a.jsxs("span",{children:[s.nama_anonim.length,"/",e.nama_anonim]})})]}),a.jsxs("div",{className:"form-two",children:[a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Mood"}),a.jsx("input",{placeholder:"Senang, sedih, semangat…",value:s.mood,maxLength:e.mood,onChange:o=>n({...s,mood:o.target.value})}),a.jsx("div",{className:"hint-row",children:a.jsxs("span",{children:[s.mood.length,"/",e.mood]})})]}),a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Untuk"}),a.jsx("input",{placeholder:"Ditujukan kepada siapa (opsional)",value:s.to,maxLength:e.to,onChange:o=>n({...s,to:o.target.value})}),a.jsx("div",{className:"hint-row",children:a.jsxs("span",{children:[s.to.length,"/",e.to]})})]})]}),a.jsxs("div",{className:"form-field",children:[a.jsx("label",{children:"Isi Pesan"}),a.jsx("textarea",{rows:"6",placeholder:"Tulis pesanmu di sini…",value:s.isi_pesan,maxLength:e.isi_pesan,onChange:o=>n({...s,isi_pesan:o.target.value})}),a.jsxs("div",{className:"hint-row",children:[a.jsxs("span",{children:[s.isi_pesan.length,"/",e.isi_pesan]}),a.jsx("em",{children:"Hindari SARA dan kata kasar."})]})]}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{className:"btn neon large",disabled:r||s.isi_pesan.trim().length<3,children:r?"Mengirim…":"Kirim"})})]})]})]})}export{P as default};
