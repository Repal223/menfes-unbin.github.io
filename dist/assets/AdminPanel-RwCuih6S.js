const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/time-90eS6vHA.js","assets/index-DmEEzxp2.js","assets/index-BKzQMRVJ.css"])))=>i.map(i=>d[i]);
import{j as e,r as s,y as $,z,A as H,B as J,n as B,c as A,d as r,s as T,C as q,D as N,E as Q,F as X,f as y,G as Y,a as G,h as M,_ as Z,k as F,H as K,I as ee}from"./index-DmEEzxp2.js";import{f as ae}from"./time-90eS6vHA.js";function te({posts:m,onDelete:f,onReply:d,onReact:b}){return e.jsxs("div",{style:{display:"grid",gap:16},children:[m.length===0&&e.jsx("p",{children:"Belum ada postingan."}),m.map(o=>e.jsxs("div",{style:{background:"rgba(255,255,255,0.85)",borderRadius:12,padding:12,boxShadow:"0 5px 15px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:o.nama_anonim||"Anonim"}),e.jsx("small",{style:{opacity:.7},children:ae(o.created_at)})]}),e.jsxs("p",{style:{fontSize:14,opacity:.8,margin:"6px 0"},children:["Mood: ",o.mood," • ",o.to]}),e.jsx("p",{style:{margin:0},children:o.isi_pesan}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{onClick:()=>f(o.id,o.nama_anonim),style:{background:"#b23a48",color:"#fff",border:"none",borderRadius:8,padding:"6px 10px",cursor:"pointer"},children:"Hapus"}),e.jsx("button",{onClick:()=>{const l=window.prompt("Balas postingan ini sebagai admin:");l&&d(o,l)},style:{background:"#4B3C2D",color:"#fff",border:"none",borderRadius:8,padding:"6px 10px",cursor:"pointer"},children:"Balas"}),e.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx("span",{style:{fontSize:12,opacity:.8},children:"Emoji:"}),[{key:"heart",icon:"❤️"},{key:"like",icon:"👍"},{key:"laugh",icon:"😂"},{key:"wow",icon:"😮"},{key:"sad",icon:"😢"}].map(l=>e.jsx("button",{onClick:()=>b(o,l.key),title:`Reaksi ${l.key}`,style:{background:"#e9ded8",border:"1px solid rgba(0,0,0,0.08)",borderRadius:8,padding:"4px 8px",cursor:"pointer"},children:l.icon},l.key))]})]})]},o.id))]})}function ne(){const[m,f]=s.useState(""),[d,b]=s.useState(""),[o,l]=s.useState(""),[i,k]=s.useState(null),[w,S]=s.useState(0),[C,j]=s.useState(!1),[P,D]=s.useState(!1),I=async p=>{if(p.preventDefault(),!i||!m.trim())return alert("Lengkapi data terlebih dahulu!");j(!0);const v=$(z,`galeri/${Date.now()}_${i.name}`),R=H(v,i);R.on("state_changed",h=>{const a=h.bytesTransferred/h.totalBytes*100;S(Math.round(a))},h=>{alert("Gagal upload gambar: "+h.message),j(!1)},async()=>{const h=await J(R.snapshot.ref);await B(A(r,"galeri"),{judul:m.trim(),deskripsi:d.trim(),url:h,uploader:"admin",kategori:o.trim()||"Lainnya",total_likes:0,total_comments:0,created_at:T()}),f(""),b(""),l(""),k(null),j(!1),D(!0),setTimeout(()=>D(!1),2500)})};return e.jsxs("div",{style:{background:"rgba(255,255,255,0.85)",borderRadius:20,boxShadow:"0 4px 20px rgba(0,0,0,0.1)",padding:20,margin:"20px 0"},children:[e.jsx("h3",{style:{color:"#4B3C2D",marginBottom:10},children:"➕ Tambah Galeri UNBIN"}),e.jsxs("form",{onSubmit:I,children:[e.jsx("input",{type:"text",placeholder:"Judul Foto",value:m,onChange:p=>f(p.target.value),style:{width:"100%",padding:10,borderRadius:10,marginBottom:10}}),e.jsxs("select",{value:o,onChange:p=>l(p.target.value),style:{width:"100%",padding:10,borderRadius:10,marginBottom:10},children:[e.jsx("option",{value:"",children:"Pilih Kategori"}),e.jsx("option",{children:"Event"}),e.jsx("option",{children:"Akademik"}),e.jsx("option",{children:"Kampus"}),e.jsx("option",{children:"Lainnya"})]}),e.jsx("textarea",{placeholder:"Deskripsi...",value:d,onChange:p=>b(p.target.value),style:{width:"100%",padding:10,borderRadius:10,marginBottom:10,height:80}}),e.jsx("input",{type:"file",accept:"image/*",onChange:p=>{var v;return k(((v=p.target.files)==null?void 0:v[0])||null)},style:{marginBottom:10}}),C?e.jsxs("p",{children:[" Mengunggah... ",w,"%"]}):e.jsx("button",{type:"submit",style:{background:"#4B3C2D",color:"#fff",padding:"10px 20px",borderRadius:10,border:"none",cursor:"pointer"},children:"Upload"}),P&&e.jsx("p",{style:{color:"green",marginTop:10},children:"✅ Gambar berhasil diunggah!"})]})]})}function se({onLogin:m}){const[f,d]=s.useState(""),[b,o]=s.useState(""),[l,i]=s.useState(""),[k,w]=s.useState(!1),[S,C]=s.useState(!1),[j,P]=s.useState(0),[D,I]=s.useState(0),[p,v]=s.useState(!1),R=async a=>{var t,n,g,x,_;if(a.preventDefault(),i(""),Date.now()<D){i("Terlalu banyak percobaan. Coba lagi sebentar.");return}w(!0);try{const c=(f||"").trim(),u=b,L=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"),V=((n=(t=import.meta)==null?void 0:t.env)==null?void 0:n.VITE_ALLOW_LOCAL_ADMIN)==="1";if((L||V)&&c==="admin"&&u==="menfes-unbin25"){localStorage.setItem("isAdmin","true"),w(!1),m(!0);return}const O=(((x=(g=import.meta)==null?void 0:g.env)==null?void 0:x.VITE_ADMIN_EMAIL)||"admin@menfes-unbin.web.app").trim().toLowerCase(),U=(c.includes("@")?c:O).trim().toLowerCase();if(!/.+@.+\..+/.test(U)||u.length<6)throw new Error("Masukkan email valid untuk admin.");const W=await q(N,U,u),E=await Q(W.user,!0);if(((_=E==null?void 0:E.claims)==null?void 0:_.admin)===!0)localStorage.setItem("isAdmin","true"),m(!0);else{try{if((await X(y(r,"admins",W.user.uid))).exists()){localStorage.setItem("isAdmin","true"),m(!0);return}}catch{}localStorage.removeItem("isAdmin"),i("Akun belum diberi akses admin. Tambahkan claim admin atau daftar di admins/{uid}.")}}catch(c){P(L=>L+1),j+1>=5&&I(Date.now()+6e4);const u=c&&c.code||"";typeof u=="string"&&u.includes("operation-not-allowed")?i("Gagal login: Email/Password provider belum diaktifkan. Aktifkan di Firebase Console → Authentication → Sign-in method → Email/Password."):typeof u=="string"&&u.includes("user-not-found")?i("Gagal login: Akun admin belum dibuat. Tambah user di Firebase Console → Authentication → Users (email admin@menfes-unbin.web.app)."):typeof u=="string"&&u.includes("wrong-password")?i("Gagal login: Kata sandi salah."):typeof u=="string"&&u.includes("invalid-email")?i("Gagal login: Format email tidak valid."):typeof u=="string"&&u.includes("invalid-credential")?i("Gagal login: Email atau kata sandi tidak cocok. Coba reset password di halaman ini atau setel ulang dari Firebase Console."):i("Gagal login: "+((c==null?void 0:c.message)||""))}finally{w(!1)}},h=async()=>{i("");const a=(f||"").trim().toLowerCase();if(!/.+@.+\..+/.test(a)){i("Masukkan email yang valid");return}try{const n={url:(typeof window<"u"&&window.location&&window.location.origin?window.location.origin:"https://menfes-unbin.web.app")+"/admin",handleCodeInApp:!1};await Y(N,a,n),alert("Tautan reset password telah dikirim ke email")}catch(t){i("Gagal mengirim reset password: "+((t==null?void 0:t.message)||""))}};return e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",background:"linear-gradient(135deg, #cbb092, #f8e9d8, #e1c9a6)"},children:e.jsxs("div",{style:{background:"rgba(255,255,255,0.8)",borderRadius:20,padding:30,boxShadow:"0 10px 40px rgba(0,0,0,0.15)",width:320,textAlign:"center"},children:[e.jsx("h2",{style:{color:"#4B3C2D",letterSpacing:1},children:"Masuk"}),e.jsxs("form",{onSubmit:R,children:[e.jsx("input",{placeholder:"Username atau email",value:f,onChange:a=>d(a.target.value),style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #ccc",margin:"8px 0"}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{placeholder:"Kata sandi",type:S?"text":"password",value:b,onChange:a=>o(a.target.value),onKeyUp:a=>v(a.getModifierState&&a.getModifierState("CapsLock")),style:{width:"100%",padding:10,borderRadius:10,border:"1px solid #ccc",margin:"8px 0"}}),e.jsx("button",{type:"button",onClick:()=>C(a=>!a),style:{position:"absolute",right:10,top:10,background:"transparent",border:"none",cursor:"pointer"},children:S?"🙈":"👁️"})]}),p&&e.jsx("p",{style:{color:"#b23a48",marginTop:-6,fontSize:12},children:"Caps Lock aktif"}),l&&e.jsx("p",{style:{color:"red"},children:l}),e.jsx("button",{type:"submit",style:{width:"100%",background:"linear-gradient(135deg,#1f1c2c,#928dab)",color:"#fff",border:"none",borderRadius:10,padding:10,cursor:"pointer",marginTop:8,boxShadow:"0 10px 30px rgba(0,0,0,0.2)"},disabled:k||!f.trim()||!b,children:k?"Memproses...":"Masuk"}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:8},children:e.jsx("button",{type:"button",onClick:h,style:{background:"transparent",border:"none",color:"#4B3C2D",cursor:"pointer",textDecoration:"underline"},children:"Lupa password?"})})]})]})})}function le(){const[m,f]=s.useState([]),[d,b]=s.useState(localStorage.getItem("isAdmin")==="true"),[o,l]=s.useState("open"),[i,k]=s.useState("Server aktif"),[w,S]=s.useState(""),[C,j]=s.useState("");s.useEffect(()=>{if(!d)return;const a=G(A(r,"posts"),t=>{f(t.docs.map(n=>({id:n.id,...n.data()})))});return()=>a()},[d]),s.useEffect(()=>{if(!d)return;const a=y(r,"appConfig","status"),t=G(a,n=>{if(n.exists()){const g=n.data();l(g.status||"open"),k(g.message||"Server aktif")}});return()=>t()},[d]),s.useEffect(()=>{if(!d)return;const a=y(r,"appConfig","push"),t=G(a,n=>{if(n.exists()){const g=n.data();S((g.vapidKey||g.vapid||"").trim()),j((g.webhook||"").trim())}});return()=>t()},[d]);const P=async(a,t)=>{try{await M(y(r,"posts",a),{deleted:!0});let n=t||"anon";try{const{getDoc:g}=await Z(async()=>{const{getDoc:_}=await import("./time-90eS6vHA.js").then(c=>c.i);return{getDoc:_}},__vite__mapDeps([0,1,2])),x=await g(y(r,"posts",a));x.exists()&&typeof x.data().uid=="string"&&(n=x.data().uid)}catch{}await B(A(r,"notifications"),{to:n,type:"hapus",message:"Postingan Anda telah disembunyikan oleh admin karena melanggar aturan.",created_at:T()}),alert("Postingan dihapus dan notifikasi terkirim ✅");try{await h(n,{title:"Menfes UNBIN",body:"Postingan Anda dihapus oleh admin.",url:"/"})}catch{}}catch(n){console.error("Gagal hapus:",n),alert("Gagal menghapus atau mengirim notifikasi")}},D=async(a,t)=>{if(!(!t||!t.trim()))try{await B(A(r,"posts",a.id,"comments"),{uid:"admin",text:t.trim(),created_at:T(),parentId:null}),await M(y(r,"posts",a.id),{total_comments:F(1)}),await B(A(r,"notifications"),{to:a.uid||a.nama_anonim||"anon",type:"reply",message:`Admin membalas postingan Anda: ${t.trim().slice(0,60)}...`,created_at:T()}),alert("Balasan terkirim ✅");try{await h(a.uid||a.nama_anonim,{title:"Balasan baru",body:t.trim().slice(0,60)+"...",url:/post/})}catch{}}catch(n){console.error("Gagal balas:",n),alert("Gagal mengirim balasan")}},I=async(a,t)=>{try{const n=y(r,"posts",a.id);await M(n,{[t==="heart"?"love":t]:F(1),[`reacted_by.admin.${t}`]:!0}),await B(A(r,"notifications"),{to:a.uid||a.nama_anonim||"anon",type:"react",message:`Admin menyukai/merespon postingan Anda (${t==="heart"?"❤️":t})`,created_at:T()}),alert("Reaksi admin tersimpan ✅");try{await h(a.uid||a.nama_anonim,{title:"Aktivitas baru",body:"Admin memberi reaksi pada postingan Anda.",url:/post/})}catch{}}catch(n){console.error("Gagal reaksi:",n),alert("Gagal menyimpan reaksi")}},p=async a=>{try{await K(y(r,"appConfig","status"),{status:a,message:i},{merge:!0}),l(a),alert("Status server diupdate")}catch{alert("Gagal update status")}},v=async()=>{try{const a=(w||"").trim();await K(y(r,"appConfig","push"),{vapidKey:a},{merge:!0}),alert("VAPID Key disimpan")}catch{alert("Gagal menyimpan VAPID Key")}},R=async()=>{try{const a=(C||"").trim();await K(y(r,"appConfig","push"),{webhook:a},{merge:!0}),alert("Webhook disimpan")}catch{alert("Gagal menyimpan webhook")}};async function h(a,t){try{const n=(C||"").trim();if(!a||!n)return;const x=(await ee(A(r,"tokens",a,"web"))).docs.map(_=>{var c;return(c=_.data())==null?void 0:c.token}).filter(Boolean);if(!x.length)return;await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tokens:x,notification:t})})}catch{}}return d?e.jsxs("div",{style:{background:"linear-gradient(135deg, #f8e9d8, #e1c9a6)",minHeight:"100vh",padding:"30px 10%",color:"#4B3C2D"},children:[e.jsx("h1",{children:"Panel Admin"}),e.jsx("p",{children:"Kontrol server dan moderasi postingan."}),e.jsxs("div",{className:"card",style:{padding:12,margin:"12px 0"},children:[e.jsx("strong",{children:"Status Server:"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[["open","closed","maintenance"].map(a=>e.jsx("button",{className:"btn",onClick:()=>p(a),style:{background:o===a?"#4B3C2D":"#8d6e63",color:"#fff"},children:a},a)),e.jsx("input",{value:i,onChange:a=>k(a.target.value),placeholder:"Pesan status",style:{borderRadius:10,border:"1px solid #ccc",padding:"6px 8px"}})]})]}),e.jsxs("div",{className:"card",style:{padding:12,margin:"12px 0"},children:[e.jsx("strong",{children:"Pengaturan Push (FCM Web)"}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap",alignItems:"center"},children:[e.jsx("input",{value:w,onChange:a=>S(a.target.value),placeholder:"Public VAPID Key",style:{flex:"1 1 380px",minWidth:260,borderRadius:10,border:"1px solid #ccc",padding:"6px 8px"}}),e.jsx("button",{className:"btn",onClick:v,children:"Simpan"})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap",alignItems:"center"},children:[e.jsx("input",{value:C,onChange:a=>j(a.target.value),placeholder:"Push Webhook URL (opsional)",style:{flex:"1 1 380px",minWidth:260,borderRadius:10,border:"1px solid #ccc",padding:"6px 8px"}}),e.jsx("button",{className:"btn",onClick:R,children:"Simpan"})]}),e.jsx("p",{style:{fontSize:12,opacity:.8,marginTop:8},children:"Masukkan Public VAPID Key dari Firebase Console → Cloud Messaging → Web configuration."})]}),e.jsx("div",{style:{margin:"14px 0"},children:e.jsx(ne,{})}),e.jsx("button",{onClick:()=>{localStorage.removeItem("isAdmin"),b(!1)},style:{background:"#b23a48",color:"#fff",border:"none",borderRadius:10,padding:"8px 14px",cursor:"pointer",marginBottom:20},children:"Logout"}),e.jsx(te,{posts:m,onDelete:P,onReply:D,onReact:I})]}):e.jsx(se,{onLogin:b})}export{le as default};
