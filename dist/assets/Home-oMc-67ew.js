import{r,u as F,e as G,g as H,f as _,d as k,a as D,j as n,h as w,i as R,k as j,m as L,p as P,n as K,c as I,s as M,q as J,o as O}from"./index-DmEEzxp2.js";import{f as Q}from"./time-90eS6vHA.js";import{A as V,S as X}from"./Skeletons-bPoLD281.js";import{s as Y}from"./clean-BY0QpW96.js";function Z({post:a}){const[m,u]=r.useState(a.love??a.likes??0),[g,s]=r.useState(!1),[o,x]=r.useState({like:a.like||0,laugh:a.laugh||0,wow:a.wow||0,sad:a.sad||0}),[h,v]=r.useState({}),[c,$]=r.useState(""),[S,C]=r.useState(!1),A=F(),y=G();r.useEffect(()=>{$(H())},[]),r.useEffect(()=>{if(!a.id||!c)return;const e=_(k,"posts",a.id),i=D(e,l=>{if(!l.exists())return;const t=l.data();try{(t.likes||0)>0?w(e,{love:j(t.likes||0),likes:0,liked_by:R()}).catch(()=>{}):t.liked_by&&w(e,{liked_by:R()}).catch(()=>{})}catch{}u(t.love??t.likes??0);const p=t.reacted_by&&t.reacted_by[c]||{};s(!!p.heart),v(p),x({like:t.like||0,laugh:t.laugh||0,wow:t.wow||0,sad:t.sad||0})});return()=>i()},[a.id,c]);const N=async()=>{if(!await L()){y.show("Aktifkan Anonymous Sign-in di Firebase Auth","error");return}if(S)return;C(!0);const i=_(k,"posts",a.id),l=!g;s(l),u(t=>t+(l?1:-1));try{await w(i,l?{love:j(1),[`reacted_by.${c}.heart`]:!0}:{love:j(-1),[`reacted_by.${c}.heart`]:!1}),P()}catch(t){s(!l),u(p=>p+(l?-1:1)),console.error("Love error:",t)}finally{C(!1)}},W=()=>{A(`/post/${a.id}`)},z=async()=>{const e=`${window.location.origin}/post/${a.id}`;await navigator.clipboard.writeText(e),alert("Link posting disalin!")},B=async e=>{e.stopPropagation();const i=window.prompt("Alasan lapor?");if(!(!i||!i.trim()))try{await K(I(k,"posts",a.id,"reports"),{uid:c||"anon",reason:Y(i.trim()).slice(0,500),created_at:M()}),y.show("Laporan terkirim")}catch{y.show("Gagal mengirim laporan","error")}},E=[{key:"like",icon:"👍"},{key:"laugh",icon:"😂"},{key:"wow",icon:"😮"},{key:"sad",icon:"😢"}],[T,U]=r.useState({}),q=async(e,i)=>{if(i.stopPropagation(),!await L()){y.show("Aktifkan Anonymous Sign-in di Firebase Auth","error");return}const t=Date.now();if(T[e]&&t-T[e]<500)return;U(d=>({...d,[e]:t}));const p=_(k,"posts",a.id),f=!!h[e];v(d=>({...d,[e]:!f})),x(d=>({...d,[e]:(d[e]||0)+(f?-1:1)}));try{await w(p,{[`reacted_by.${c}.${e}`]:!f,[e]:j(f?-1:1)}),P()}catch(d){v(b=>({...b,[e]:f})),x(b=>({...b,[e]:(b[e]||0)+(f?1:-1)})),console.error("Reaction error:",d)}};return n.jsxs("div",{className:"card-glow",onClick:()=>A(`/post/${a.id}`),style:{cursor:"pointer"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx(V,{id:a.uid,name:a.nama_anonim}),n.jsx("h3",{style:{margin:0},children:a.nama_anonim})]}),n.jsxs("p",{style:{fontStyle:"italic",opacity:.8},children:["Mood: ",a.mood]}),n.jsx("p",{style:{marginTop:"10px"},children:a.isi_pesan}),n.jsx("div",{style:{opacity:.7,fontSize:12,marginTop:6},children:Q(a.created_at)}),n.jsxs("div",{style:{display:"flex",gap:"16px",alignItems:"center",marginTop:"16px"},children:[n.jsxs("button",{onClick:N,disabled:S,style:{background:"transparent",border:"none",cursor:S?"not-allowed":"pointer",fontSize:"24px",color:g?"red":"#000",textShadow:g?"0 0 15px rgba(255,0,0,0.7)":"0 0 10px rgba(0,0,0,0.3)",transition:"all 0.2s ease"},children:[g?"❤️":"🤍"," ",m]}),n.jsx("button",{onClick:e=>{e.stopPropagation(),W()},style:{background:"#e9ded8",border:"none",borderRadius:10,padding:"6px 12px",color:"#3e2723",fontWeight:600,cursor:"pointer",boxShadow:"0 0 10px rgba(121,85,72,0.35)"},children:"Komentar"}),n.jsx("button",{onClick:e=>{e.stopPropagation(),z()},style:{background:"#e9ded8",border:"none",borderRadius:10,padding:"6px 12px",color:"#3e2723",fontWeight:600,cursor:"pointer",boxShadow:"0 0 10px rgba(121,85,72,0.35)"},children:"Share"}),n.jsx("button",{onClick:B,style:{background:"#e9ded8",border:"none",borderRadius:10,padding:"6px 12px",color:"#3e2723",fontWeight:600,cursor:"pointer",boxShadow:"0 0 10px rgba(121,85,72,0.35)"},children:"Laporkan"})]}),n.jsx("div",{style:{display:"flex",justifyContent:"space-around",background:"#e9ded8",borderRadius:12,padding:"6px 0",margin:"10px 0 0",boxShadow:"0 0 10px rgba(121,85,72,0.25)"},onClick:e=>e.stopPropagation(),children:E.map(e=>n.jsxs("button",{onClick:i=>q(e.key,i),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:20,fontWeight:600,display:"flex",flexDirection:"column",alignItems:"center",color:h[e.key]?"#d32f2f":"#3e2723",transform:h[e.key]?"scale(1.2)":"scale(1)",transition:"all .2s ease"},children:[e.icon,n.jsx("span",{style:{fontSize:12,marginTop:4},children:o[e.key]||0})]},e.key))})]})}function te(){const[a,m]=r.useState(null),[u,g]=r.useState("Terbaru");return r.useEffect(()=>{try{const s=J(I(k,"posts"),O("created_at","desc")),o=D(s,x=>m(x.docs.map(h=>({id:h.id,...h.data()}))));return()=>o()}catch{m([])}},[]),n.jsxs("div",{children:[n.jsx("div",{style:{marginBottom:16},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:8},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0},children:"Postingan"}),n.jsx("p",{style:{opacity:.8,margin:0},children:"Cerita, curhat, dan menfess kampus terkini"})]}),n.jsx("div",{style:{display:"flex",gap:6},children:["Terbaru","Populer"].map(s=>n.jsx("button",{className:"btn",onClick:()=>g(s),style:{background:u===s?"#4B3C2D":"#8d6e63",color:"#fff"},children:s},s))})]})}),a===null&&n.jsx("div",{className:"grid-cards",children:Array.from({length:6}).map((s,o)=>n.jsx(X,{},o))}),a!==null&&a.length===0&&n.jsx("div",{className:"card-glow",children:"Belum ada menfes"}),n.jsx("div",{className:"grid-cards",children:a!==null&&(u==="Terbaru"?a.filter(s=>!s.deleted&&!s.flagged):[...a.filter(s=>!s.deleted&&!s.flagged)].sort((s,o)=>(o.love??o.likes??0)+(o.like||0)+(o.laugh||0)+(o.wow||0)+(o.sad||0)-((s.love??s.likes??0)+(s.like||0)+(s.laugh||0)+(s.wow||0)+(s.sad||0)))).map(s=>n.jsx(Z,{post:s},s.id))})]})}export{te as default};
