import{r as i,q as S,l as D,o as $,c as _,a as b,b as A,j as t,d as k}from"./index-DmEEzxp2.js";import{d as M,a as v}from"./time-90eS6vHA.js";const u=({title:w,children:g})=>t.jsxs("div",{style:{background:"linear-gradient(145deg, rgba(255,255,255,0.75), rgba(248,244,239,0.75))",border:"1px solid rgba(75,60,45,0.1)",borderRadius:20,padding:18,boxShadow:"0 10px 30px rgba(75,60,45,0.08)",backdropFilter:"blur(8px)"},children:[t.jsx("h3",{style:{margin:"0 0 12px",color:"#4B3C2D"},children:w}),g]});function G(){const[w,g]=i.useState([]),[d,R]=i.useState([]),[c,T]=i.useState(30),[B,E]=i.useState(new Date),[p,I]=i.useState({});i.useEffect(()=>{const s=S(_(k,"posts"),$("created_at","desc"),D(500)),e=b(s,{includeMetadataChanges:!0},n=>{const a=n.docs.map(r=>({id:r.id,...r.data()})),h=v(c),m=a.filter(r=>{var o;return((o=r.created_at)!=null&&o.toDate?r.created_at.toDate():new Date)>=h});R(m)});return()=>e()},[c]),i.useEffect(()=>{const s=S(_(k,"posts"),$("total_comments","desc"),D(10)),e=b(s,{includeMetadataChanges:!0},n=>{g(n.docs.map(a=>({id:a.id,...a.data()})))});return()=>e()},[]),i.useEffect(()=>{const s=b(A(k,"comments"),{includeMetadataChanges:!0},e=>{const n=v(c),a=new Map;e.forEach(m=>{var C;const r=m.ref.parent.parent,l=r==null?void 0:r.id;if(!l)return;const o=m.data()||{};((C=o.created_at)!=null&&C.toDate?o.created_at.toDate():new Date)<n||a.set(l,(a.get(l)||0)+1)});const h=Object.fromEntries(a.entries());I(h)});return()=>s()},[c]),i.useEffect(()=>{const s=setInterval(()=>E(new Date),1e3);return()=>clearInterval(s)},[]);const y=i.useMemo(()=>{const s={};for(let e=c;e>=0;e--){const n=M(v(e));s[n]=0}return d.forEach(e=>{var h;const n=(h=e.created_at)!=null&&h.toDate?e.created_at.toDate():e.created_at||new Date;if(!n)return;const a=M(n);a in s&&(s[a]+=1)}),s},[d,c]),x=Object.keys(y),j=i.useMemo(()=>d.map(e=>({...e,score:(e.love??e.likes??0)+(e.like||0)+(e.laugh||0)+(e.wow||0)+(e.sad||0)+(p[e.id]||0)})).sort((e,n)=>n.score-e.score).slice(0,10),[d,p]),z=Math.max(1,...j.map(s=>s.score)),f=i.useMemo(()=>d.map(e=>({...e,c:p[e.id]||e.total_comments||0})).sort((e,n)=>n.c-e.c).slice(0,10),[d,p]),W=Math.max(1,...f.map(s=>s.c)),L=Math.max(1,...x.map(s=>y[s])),P=()=>{const a=x.map((l,o)=>24+o*852/Math.max(1,x.length-1)),h=x.map(l=>216-y[l]/L*(240-24*2)),m=a.map((l,o)=>`${o?"L":"M"} ${l} ${h[o]}`).join(" "),r=`${m} L ${a[a.length-1]} 216 L ${a[0]} 216 Z`;return t.jsxs("svg",{viewBox:"0 0 900 240",style:{width:"100%",height:260},children:[t.jsx("path",{d:r,fill:"rgba(121,85,72,0.18)"}),t.jsx("path",{d:m,stroke:"rgba(121,85,72,0.9)",strokeWidth:"2",fill:"none"})]})};return t.jsxs("div",{style:{padding:24,display:"grid",gap:18,gridTemplateColumns:"1fr",maxWidth:1100,margin:"0 auto"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:12},children:[t.jsx("h2",{style:{color:"#4B3C2D",margin:0},children:"Statistik"}),t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:12,opacity:.8},children:[t.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:"#2ecc71",boxShadow:"0 0 6px rgba(46,204,113,0.8)"}}),new Intl.DateTimeFormat("id-ID",{timeZone:"Asia/Jakarta",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(B)," WIB"]}),[7,30,90].map(s=>t.jsxs("button",{onClick:()=>T(s),style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.1)",background:s===c?"#d7ccc8":"#fff",cursor:"pointer"},children:[s," hari"]},s))]})]}),t.jsxs("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(3,minmax(0,1fr))"},children:[t.jsxs(u,{title:"Total Post",children:[t.jsx("div",{style:{fontSize:28,fontWeight:700},children:d.length}),t.jsxs("div",{style:{opacity:.7,fontSize:12},children:["Dalam ",c," hari terakhir"]})]}),t.jsxs(u,{title:"Total Reaksi",children:[t.jsx("div",{style:{fontSize:28,fontWeight:700},children:d.reduce((s,e)=>s+((e.love??e.likes??0)+(e.like||0)+(e.laugh||0)+(e.wow||0)+(e.sad||0)),0)}),t.jsx("div",{style:{opacity:.7,fontSize:12},children:"Love + Like + Emoji"})]}),t.jsxs(u,{title:"Total Komentar",children:[t.jsx("div",{style:{fontSize:28,fontWeight:700},children:d.reduce((s,e)=>s+(p[e.id]||e.total_comments||0),0)}),t.jsx("div",{style:{opacity:.7,fontSize:12},children:"Akumulasi komentar"})]})]}),t.jsx(u,{title:"Top Post Paling Banyak Reaksi",children:j.length?t.jsx("div",{style:{display:"grid",gap:8},children:j.map(s=>{const e=s.score,n=`${Math.max(6,e/z*100)}%`,a=`${s.nama_anonim||"Anon"} - ${(s.isi_pesan||"").slice(0,16)}.`;return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12},children:[t.jsx("span",{children:a}),t.jsx("span",{children:e})]}),t.jsx("div",{style:{background:"rgba(0,0,0,0.08)",borderRadius:8,height:12},children:t.jsx("div",{style:{width:n,height:"100%",background:"rgba(121,85,72,0.85)",borderRadius:8}})})]},s.id)})}):t.jsx("p",{children:"Belum ada data suka."})}),t.jsx(u,{title:"Top Post Paling Banyak Komentar",children:f.length?t.jsx("div",{style:{display:"grid",gap:8},children:f.map(s=>{const e=s.c,n=`${Math.max(6,e/W*100)}%`,a=`${s.nama_anonim||"Anon"} - ${(s.isi_pesan||"").slice(0,16)}.`;return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:12},children:[t.jsx("span",{children:a}),t.jsx("span",{children:e})]}),t.jsx("div",{style:{background:"rgba(0,0,0,0.08)",borderRadius:8,height:12},children:t.jsx("div",{style:{width:n,height:"100%",background:"rgba(121,85,72,0.85)",borderRadius:8}})})]},s.id)})}):t.jsx("p",{children:"Belum ada data komentar."})}),t.jsx(u,{title:`Tren Postingan per Hari (${c} Hari)`,children:t.jsx(P,{})})]})}export{G as default};
