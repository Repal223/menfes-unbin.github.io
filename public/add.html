<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kirim Menfess - Menfes UNBIN</title>
  <link rel="stylesheet" href="static/css/style.css">
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
  <script src="./firebase-config.js"></script>
  <script>
    function toast(msg){ try{ var w=document.querySelector('.toast-wrap'); if(!w){ w=document.createElement('div'); w.className='toast-wrap'; document.body.appendChild(w) } var b=document.createElement('div'); b.className='toast info in'; b.innerHTML='<span class="ico">ðŸ””</span><span>'+msg+'</span>'; w.appendChild(b); setTimeout(()=>{ b.classList.remove('in'); setTimeout(()=>b.remove(), 600) }, 3000) }catch(e){ alert(msg) } }
    window.addEventListener('DOMContentLoaded', async ()=>{
      if(!window.FIREBASE_CONFIG){ document.getElementById('status').textContent='Config Firebase belum diisi'; return }
      const app = firebase.initializeApp(window.FIREBASE_CONFIG)
      const db = firebase.firestore()
      try{ firebase.auth().signInAnonymously().catch(()=>{}) }catch{}
      const btn = document.getElementById('send'); btn.disabled = true
      firebase.auth().onAuthStateChanged(u=>{ document.getElementById('authStatus').textContent = u ? 'Terhubung sebagai anonim' : 'Menghubungkanâ€¦'; if(u) btn.disabled=false })
      document.getElementById('form').addEventListener('submit', async (e)=>{
        e.preventDefault()
        const u = firebase.auth().currentUser; if(!u){ toast('Menghubungkanâ€¦'); return }
        const name = (document.getElementById('name').value||'').trim() || 'Anon'
        const to = (document.getElementById('to').value||'').trim()
        const mood = (document.getElementById('mood').value||'').trim()
        const content = (document.getElementById('content').value||'').trim()
        if(!to || !mood || !content){ toast('Isi belum lengkap'); return }
        const mentions = (content + '\n' + to).match(/@([A-Za-z0-9_#]+)/g) || []
        try{
          await db.collection('posts').add({
            name, to, mood, content,
            likes: 0, shares: 0, comments_count: 0,
            status: 'Approved',
            mentions: mentions.map(x=>x.replace(/^@/,'')),
            created_at: new Date(),
            author_uid: u.uid
          })
          toast('Menfess terkirim');
          setTimeout(()=>{ location.href = './index.html' }, 600)
        }catch(err){ console.error(err); toast('Gagal mengirim') }
      })
    })
  </script>
</head>
<body>
  <header class="site-header"><div class="container row-between"><a href="./index.html" class="brand">Menfes UNBIN</a><nav class="nav"><a class="nav-link" href="./index.html">Home</a></nav></div></header>
  <main class="container">
    <section class="page-header"><h2>Kirim Menfess</h2><div id="authStatus" class="hint"></div><div id="status" class="hint"></div></section>
    <form id="form" class="form">
      <div class="row"><label>Nama</label><input id="name" placeholder="Anon jika kosong"/></div>
      <div class="row"><label>To</label><input id="to" required placeholder="Untuk siapa?"/></div>
      <div class="row"><label>Mood</label><input id="mood" required placeholder="Mood"/></div>
      <div class="row"><label>Isi</label><textarea id="content" rows="5" required placeholder="Tulis menfess kamuâ€¦"></textarea></div>
      <div class="actions"><button id="send" class="btn-primary" type="submit">Kirim</button><a class="btn" href="./index.html">Batal</a></div>
      <div class="hint">Komentar dan posting mengikuti aturan Anonymous Auth.</div>
    </form>
  </main>
  <footer class="site-footer"><div class="container row-between"><p>c BEM KM UNBIN</p></div></footer>
</body>
</html>



